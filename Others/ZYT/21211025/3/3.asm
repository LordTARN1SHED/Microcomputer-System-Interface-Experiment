P8255A EQU 0640H
P8255B EQU 0642H
P8255C EQU 0644H
P8255CON EQU 0646H
SSTACK	SEGMENT STACK
	DW 32 DUP(0)
SSTACK	ENDS
 
CODE   	SEGMENT
	ASSUME CS:CODE
 
START: 	
	MOV DX,P8255CON
	MOV AL,10010000B   
	OUT DX,AL	
NEXT:
	MOV AL,0FFH	
	MOV DX,P8255B
	OUT DX,AL	
		
	PUSH DS
	MOV AX, 0000H	
	MOV DS, AX
	
	MOV AX, OFFSET MIR7	
	MOV SI, 003CH		
    MOV [SI], AX	
	MOV AX, CS		
	MOV SI, 003EH		
	MOV [SI], AX			
		
	MOV AX, OFFSET MIR6			
	MOV SI, 0038H
	MOV [SI], AX
	MOV AX, CS
	MOV SI, 003AH
	MOV [SI], AX
	
	POP DS
	
	CLI			
	
	;初始化主片8259
	MOV AL, 11H		
	OUT 20H, AL		
	MOV AL, 08H		
	OUT 21H, AL		
	MOV AL, 04H			
	OUT 21H, AL		
	MOV AL, 01H		
	OUT 21H, AL	
 
	;初始化从片8259
	MOV AL, 11H	
	OUT 0A0H, AL		
	MOV AL, 30H		
	OUT 0A1H, AL	
	MOV AL, 02H	
	OUT 0A1H, AL	
	MOV AL, 01H		
	OUT 0A1H, AL	
	MOV AL, 0FDH
	OUT 0A1H,AL	
	MOV AL, 2BH       	
	OUT 21H, AL	
	STI			
;主程序段
MAIN:	
	NOP
	MOV AL,0FFH	
	MOV DX,P8255B
	OUT DX,AL	
	JMP MAIN

MIR7:
	MOV AL,0F0H		
	MOV DX,P8255B
	OUT DX,AL		
	MOV AL, 20H		
	OUT 20H, AL		
	CALL DELAY
	IRET			

MIR6:
	MOV AL,00FH		
	MOV DX,P8255B
	OUT DX,AL	
	MOV AL, 20H
	OUT 20H, AL		
	CALL DELAY
	IRET
		
;延时子程序
DELAY:	
	PUSH CX			
	MOV AL, 05H
AA1:	
	MOV CX, 0FFFFH	
AA0:	
	PUSH AX
	POP  AX
	LOOP AA0
	SUB AL,1
	JNZ AA1
	POP CX
	RET
CODE	ENDS
	END  START