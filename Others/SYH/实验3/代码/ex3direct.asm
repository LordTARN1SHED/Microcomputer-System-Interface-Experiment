A8255	EQU	0640H
B8255	EQU 0642H
C8255	EQU 0644H
CON8255	EQU 0646H

SSTACK SEGMENT STACK
	DW 32 DUP(?)
SSTACK ENDS

DATA SEGMENT
	DIS DB 01H
DATA ENDS

CODE SEGMENT
	ASSUME CS:CODE, SS:SSTACK, DS:DATA
	
START:	MOV DX, CON8255
		MOV AL, 90H
		OUT DX, AL
		
		CLI
		
		;ICW1
		MOV DX, 0020H	
		MOV AL, 11H
		OUT DX, AL
	
		;ICW2
		MOV DX, 0021H
		MOV AL, 08H
		OUT DX, AL
	
		;ICW3
		MOV DX, 0021H
		MOV AL, 04H
		OUT DX, AL
		
		;ICW4
		MOV DX, 0021H
		MOV AL, 07H
		OUT DX, AL
		
		;OCW1
		MOV DX, 0021H
		MOV AL, 3FH
		OUT DX, AL
		
		STI
		
		;IR6
		MOV SI, 0038H
		MOV AX, OFFSET IR6
		MOV [SI], AX
		MOV AX, CS
		MOV [SI+2], AX
		
		;IR7
		MOV SI, 003CH
		MOV AX, OFFSET IR7
		MOV [SI], AX
		MOV AX, CS
		MOV [SI+2], AX
		
		MOV DIS, 01H
		
AA1:	;MOV AL, DIS
		;MOV DX, B8255
		;OUT	DX, AL
		NOP
		NOP
		JMP AA1

IR6:	PUSH AX
		MOV AL, DIS
BB6:	MOV DX, B8255
		OUT	DX, AL
		CALL DELAY
		ROL AL, 1H
		CMP AL, 01H
		JNZ	BB6
		ROR AL, 1H
		MOV DIS, AL
		POP AX
		;STI
		IRET

IR7:	STI
		MOV AL, DIS
BB7:	MOV DX, B8255
		OUT	DX, AL
		CALL DELAY
		ROR AL, 1H
		MOV DIS, AL
		CMP AL, 80H
		JNZ	BB7
		ROL AL, 1H
		MOV DIS, AL
		IRET

DELAY:
	PUSH CX
	PUSH AX
	MOV AX, 0FFH
AA6:
	MOV CX, 01FFH
AA5:
	DEC CX
	CMP CX, 00H
	JNE AA5
	DEC AX
	CMP AX, 00H
	JNE AA6
	POP AX
	POP CX
	RET

CODE ENDS
	END START


	