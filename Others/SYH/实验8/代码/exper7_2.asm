A8255    EQU  0600H
B8255    EQU  0602H
C8255    EQU  0604H
CON8255  EQU  0606H

A8254    EQU  0640H
B8254    EQU  0642H
C8254    EQU  0644H
CON8254  EQU  0646H

SSTACK	SEGMENT STACK
		DW 32 DUP(?)
SSTACK	ENDS

DATA SEGMENT
TAB DB 00H
	DB 00H
	DB 00H
	DB 4FH
  	DB 5BH
	DB 06H
OFFSTART DB 00H
POSI DB 00H
NUMB DB 00H

DATA ENDS

CODE SEGMENT
	ASSUME CS:CODE, SS:SSTACK, DS:DATA

START:
	;初始化8255方式控制字
	MOV DX, CON8255
	MOV AL, 89H
	OUT DX, AL
	
	CLI
	;ICW1
	MOV DX, 0020H
	MOV AL, 11H
	OUT DX, AL
	
	;ICW2
	MOV DX, 0021H
	MOV AL, 08H
	OUT DX, AL
	
	;ICW3
	MOV DX, 0021H
	MOV AL, 04H
	OUT DX, AL
	
	;ICW4
	MOV DX, 0021H
	MOV AL, 07H
	OUT DX, AL
	
	;OCW1
	MOV DX, 0021H
	MOV AL, 0BFH
	OUT DX, AL
	
	STI
	
	;IR6
	MOV SI, 0038H
	MOV AX, OFFSET IR6
	MOV [SI], AX
	MOV AX, CS
	MOV [SI+2], AX
	
	
	MOV DX, CON8254			;8254
	MOV AL, 34H				;计数器0，方式3
	OUT DX, AL
		
	MOV DX, A8254
	MOV AL, 050H
	OUT DX, AL
	MOV AL, 0C3H
	OUT DX, AL

	MOV DX, CON8254			;8254
	MOV AL, 74H				;计数器1，方式3
	OUT DX, AL
		
	MOV DX, B8254
	MOV AL, 014H
	OUT DX, AL
	MOV AL, 00H
	OUT DX, AL

	MOV AX, DATA
	MOV DS, AX
	MOV OFFSTART, 00H
	
AA1:
	MOV POSI, 0DFH
	MOV AL, OFFSTART
	MOV NUMB, AL
	MOV CX, 0006H
AA2:
	MOV AX, 02FH
AA3:
	CALL SHOW
	CALL DELAY
	
	DEC AX
	JNZ AA3
	
	ROR POSI, 1H
	INC NUMB
	CMP NUMB, 06H
	JNZ SKIP
	MOV NUMB, 00H
SKIP:
	LOOP AA2
	
	JMP AA1
	
DELAY:
	PUSH CX
	PUSH AX
	
	MOV CX, 01H
A5:	
	MOV AX, 0FH
A6:	
	DEC AX
	JNZ A6
	LOOP A5
	
	POP AX
	POP CX
	RET
	
SHOW PROC
	PUSH CX
	PUSH AX
	PUSH DX
	
	MOV DX, A8255
	MOV AL, POSI
	OUT DX, AL
	
	MOV DX, B8255
	MOV BX, OFFSET TAB
	MOV AL, NUMB
	ADD BX, AX
	MOV AL, [DS:BX]
	OUT DX, AL
	
	POP DX
	POP AX
	POP CX
	RET
SHOW ENDP

IR6:
	INC OFFSTART
	CMP OFFSTART, 06H
	JNZ FAN
	MOV OFFSTART, 00H
FAN:
	NOP
	IRET
		
CODE	ENDS
		END  START